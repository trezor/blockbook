# Satoxcoin SLIP44 Implementation Guide

## Overview

This document explains how SLIP44 (BIP44 Coin Type) is implemented in the Satoxcoin Blockbook and why it's crucial for hardware wallet compatibility.

## What is SLIP44?

**SLIP44** (also known as BIP44 Coin Type) is a standard that defines unique coin type numbers for hierarchical deterministic (HD) wallets. It ensures that different cryptocurrencies use different derivation paths to avoid conflicts.

### Standard Format
```
m/44'/COIN_TYPE'/0'/0/0
```

Where:
- `m` = Master key
- `44'` = BIP44 standard (hardened)
- `COIN_TYPE'` = SLIP44 coin type (hardened)
- `0'` = Account (hardened)
- `0` = Change (0 = external, 1 = internal)
- `0` = Address index

## Satoxcoin SLIP44 Values

### Current Implementation
- **Legacy SLIP44:** `1669` (used by existing nodes and wallets)
- **New SLIP44:** `9007` (for hardware wallet compatibility)

### Why Two Values?

1. **Legacy (1669):** Used by existing Satoxcoin nodes and wallets
2. **New (9007):** Registered for hardware wallet support and future compatibility

## How Blockbook Uses SLIP44

### Important Distinction

**SLIP44 in Blockbook is ONLY used for XPUB derivation paths, NOT for blockchain parsing.**

### Blockchain Parsing vs Wallet Derivation

| Component | Purpose | Uses |
|-----------|---------|------|
| **Blockchain Parsing** | Parse addresses from blocks | Address prefixes (63 for 'S', 122 for 's') |
| **SLIP44** | Generate wallet derivation paths | XPUB paths (`m/44'/9007'/0'/0/0`) |

### Code Implementation

**In `bitcoinlikeparser.go` line 580:**
```go
return "m/" + descriptor.Bip + "'/" + strconv.Itoa(int(p.Slip44)) + "'/" + c, nil
```

This generates derivation paths like:
- `m/44'/9007'/0'/0/0` (for Satoxcoin with SLIP44 9007)
- `m/44'/0'/0'/0/0` (for Bitcoin with SLIP44 0)

## Configuration Files

### Current Blockbook Configuration
```json
{
    "slip44": 9007,
    "xpub_magic": 76067358,
    "xpub_magic_segwit_p2sh": 77429938,
    "xpub_magic_segwit_native": 78792518
}
```

### Address Prefixes (for blockchain parsing)
```go
MainNetParams.PubKeyHashAddrID = []byte{63}  // 'S' prefix
MainNetParams.ScriptHashAddrID = []byte{122} // 's' prefix
```

## Hardware Wallet Compatibility

### Why SLIP44 9007?

1. **Unique Registration:** SLIP44 9007 is officially registered for Satoxcoin
2. **Hardware Support:** Hardware wallets recognize this value
3. **Future Proof:** Ensures long-term compatibility
4. **No Conflicts:** Avoids conflicts with other cryptocurrencies

### Hardware Wallet Derivation
```
m/44'/9007'/0'/0/0  // First external address
m/44'/9007'/0'/0/1  // Second external address
m/44'/9007'/0'/1/0  // First internal address (change)
```

## Migration Strategy

### Current State
- **Blockchain:** Contains addresses generated with SLIP44 1669
- **Blockbook:** Uses SLIP44 9007 for XPUB derivation
- **Hardware Wallets:** Will use SLIP44 9007 for new addresses

### Compatibility
- ✅ **Legacy addresses** (SLIP44 1669) - Still valid and supported
- ✅ **New addresses** (SLIP44 9007) - Generated by hardware wallets
- ✅ **Blockchain parsing** - Works with both address types
- ✅ **XPUB derivation** - Uses SLIP44 9007 for new wallets

## Implementation Details

### Blockbook Parser Configuration
```go
// In satoxcoinparser.go
MainNetParams.HDCoinType = 9007  // SLIP44 for wallet derivation
MainNetParams.PubKeyHashAddrID = []byte{63}  // Address prefix for parsing
```

### Configuration Files
```json
// blockchaincfg.json
{
    "slip44": 9007,
    "coin_name": "Satoxcoin",
    "rpc_url": "http://127.0.0.1:7777"
}
```

## Testing

### Verify SLIP44 Implementation
```bash
# Check XPUB derivation path
curl -s http://localhost:6110/api/xpub/xpub... | jq '.path'
# Should return: "m/44'/9007'/0'/0/0"
```

### Verify Address Parsing
```bash
# Check address parsing (uses address prefixes, not SLIP44)
curl -s http://localhost:6110/api/address/SQ5iQMsmqZiYY96rTx5Hisd7sx5GiGUbbN
```

## Best Practices

1. **Use SLIP44 9007** for new hardware wallet implementations
2. **Keep SLIP44 1669** for legacy compatibility
3. **Address parsing** uses prefixes, not SLIP44
4. **XPUB derivation** uses SLIP44 for path generation
5. **Document both values** for developers

## Troubleshooting

### Common Issues

**Issue:** "Invalid derivation path"
- **Solution:** Ensure hardware wallet supports SLIP44 9007

**Issue:** "Address not found"
- **Solution:** Check address prefixes, not SLIP44 value

**Issue:** "XPUB not recognized"
- **Solution:** Verify XPUB magic bytes match SLIP44 9007

### Debug Commands
```bash
# Check current SLIP44 configuration
grep "slip44" blockchaincfg.json

# Verify XPUB magic bytes
grep "xpub_magic" blockchaincfg.json

# Test address parsing
curl -s http://localhost:6110/api/address/SQ5iQMsmqZiYY96rTx5Hisd7sx5GiGUbbN
```

## References

- [SLIP44 Specification](https://github.com/satoshilabs/slips/blob/master/slip-0044.md)
- [BIP44 Specification](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki)
- [Satoxcoin Repository](https://github.com/satoverse/satoxcoin)
- [Blockbook Documentation](https://github.com/trezor/blockbook)

## Conclusion

The Satoxcoin Blockbook implementation correctly uses:
- **SLIP44 9007** for XPUB derivation paths (hardware wallet compatibility)
- **Address prefixes** for blockchain parsing (63, 122)
- **No conflicts** between legacy and new implementations

This ensures full compatibility with both existing Satoxcoin infrastructure and modern hardware wallets. 