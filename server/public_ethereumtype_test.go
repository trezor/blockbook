//go:build unittest
// +build unittest

package server

import (
	"net/http"
	"net/http/httptest"
	"testing"

	"github.com/golang/glog"
	"github.com/linxGnu/grocksdb"
	"github.com/trezor/blockbook/bchain"
	"github.com/trezor/blockbook/bchain/coins/eth"
	"github.com/trezor/blockbook/db"
	"github.com/trezor/blockbook/tests/dbtestdata"
)

func httpTestsEthereumType(t *testing.T, ts *httptest.Server) {
	tests := []httpTests{
		{
			name:        "explorerAddress " + dbtestdata.EthAddr7b,
			r:           newGetRequest(ts.URL + "/address/" + dbtestdata.EthAddr7b),
			status:      http.StatusOK,
			contentType: "text/html; charset=utf-8",
			body: []string{
				`<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"><link rel="stylesheet" href="/static/css/main.css"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="Trezor Fake Coin Explorer"><title>Trezor Fake Coin Explorer</title></head><body><header id="header"><div class="container"><nav class="navbar navbar-expand-md navbar-dark bg-trezor"><a class="navbar-brand" href="/" title="Home"><div alt="Trezor Wallet" style="margin-top: 3px;"><svg width="100" version="1.1" id="logotyp" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 163.7 41.9" space="preserve"><polygon points="101.1,12.8 118.2,12.8 118.2,17.3 108.9,29.9 118.2,29.9 118.2,35.2 101.1,35.2 101.1,30.7 110.4,18.1 101.1,18.1"></polygon><path d="M158.8,26.9c2.1-0.8,4.3-2.9,4.3-6.6c0-4.5-3.1-7.4-7.7-7.4h-10.5v22.3h5.8v-7.5h2.2l4.1,7.5h6.7L158.8,26.9z M154.7,22.5h-4V18h4c1.5,0,2.5,0.9,2.5,2.2C157.2,21.6,156.2,22.5,154.7,22.5z"></path><path d="M130.8,12.5c-6.8,0-11.6,4.9-11.6,11.5s4.9,11.5,11.6,11.5s11.7-4.9,11.7-11.5S137.6,12.5,130.8,12.5z M130.8,30.3c-3.4,0-5.7-2.6-5.7-6.3c0-3.8,2.3-6.3,5.7-6.3c3.4,0,5.8,2.6,5.8,6.3C136.6,27.7,134.2,30.3,130.8,30.3z"></path><polygon points="82.1,12.8 98.3,12.8 98.3,18 87.9,18 87.9,21.3 98,21.3 98,26.4 87.9,26.4 87.9,30 98.3,30 98.3,35.2 82.1,35.2"></polygon><path d="M24.6,9.7C24.6,4.4,20,0,14.4,0S4.2,4.4,4.2,9.7v3.1H0v22.3h0l14.4,6.7l14.4-6.7h0V12.9h-4.2V9.7z M9.4,9.7c0-2.5,2.2-4.5,5-4.5s5,2,5,4.5v3.1H9.4V9.7z M23,31.5l-8.6,4l-8.6-4V18.1H23V31.5z"></path><path d="M79.4,20.3c0-4.5-3.1-7.4-7.7-7.4H61.2v22.3H67v-7.5h2.2l4.1,7.5H80l-4.9-8.3C77.2,26.1,79.4,24,79.4,20.3z M71,22.5h-4V18h4c1.5,0,2.5,0.9,2.5,2.2C73.5,21.6,72.5,22.5,71,22.5z"></path><polygon points="40.5,12.8 58.6,12.8 58.6,18.1 52.4,18.1 52.4,35.2 46.6,35.2 46.6,18.1 40.5,18.1"></polygon></svg></div></a><a class="navbar-brand" href="/">Fake Coin Explorer</a><button class="navbar-toggler" type="button" onclick="if(document.getElementById('toggler').className.indexOf('show')>0){document.getElementById('toggler').className='navbar-collapse collapse'}else{document.getElementById('toggler').className='navbar-collapse show'}"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="toggler"><ul class="navbar-nav ml-md-auto"><li class="nav-item"><a href="/blocks" class="nav-link">Blocks</a></li><li class="nav-item"><a href="/" class="nav-link">Status</a></li></ul><span class="navbar-form ml-md-auto"><form id="search" action="/search" method="get"><input name="q" type="text" class="form-control" placeholder="Search for block, transaction, address or xpub" focus="true"></form></span><ul class="navbar-nav ml-md-auto"><li class="nav-item"><a class="nav-link" href="https://trezor.io/" target="_blank" rel="noopener noreferrer">Trezor</a></li><li class="nav-item"><a class="nav-link" href="https://suite.trezor.io/" target="_blank" rel="noopener noreferrer">Suite</a></li><li class="nav-item"><a class="nav-link" href="https://trezor.io/support" target="_blank" rel="noopener noreferrer">Support</a></li></ul></div></nav></div></header><main id="wrap"><div class="container"><h1>Address <small class="text-muted">0.000000000123450123 FAKE</small></h1><div class="alert alert-data ellipsis"><span class="data">0x7B62EB7fe80350DC7EC945C0B73242cb9877FB1b</span></div><h3>Confirmed</h3><div class="data-div row"><div class="col-lg-10"><table class="table data-table"><tbody><tr><td style="width: 25%;">Balance</td><td class="data">0.000000000123450123 FAKE</td></tr><tr><td>Transactions</td><td class="data">2</td></tr><tr><td>Non-contract Transactions</td><td class="data">0</td></tr><tr><td>Internal Transactions</td><td class="data">0</td></tr><tr><td>Nonce</td><td class="data">123</td></tr><tr><td>ERC20 Tokens</td><td style="padding: 0;"><table class="table data-table"><tbody><tr><th>Contract</th><th>Tokens</th><th style="width: 15%;">Transfers</th></tr><tr><td class="data ellipsis"><a href="/address/0x4af4114F73d1c1C903aC9E0361b379D1291808A2">Contract 74</a></td><td class="data">0.001000123074 S74</td><td class="data">1</td></tr><tr><td class="data ellipsis"><a href="/address/0x0d0F936Ee4c93e25944694D6C121de94D9760F11">Contract 13</a></td><td class="data">0.000000001000123013 S13</td><td class="data">1</td></tr></tbody></table></td></tr><tr><td>ERC721 Tokens</td><td style="padding: 0;"><table class="table data-table"><tbody><tr><th>Contract</th><th>Tokens</th><th style="width: 15%;">Transfers</th></tr><tr><td class="data ellipsis"><a href="/address/0xcdA9FC258358EcaA88845f19Af595e908bb7EfE9">Contract 205</a></td><td class="data">1</td><td class="data">1</td></tr></tbody></table></td></tr></tr></tbody></table></div><div class="col-lg-2"><div id="qrcode" style="width: 160px; height: 160px; float: right; padding-left: 10px;"></div><script type="text/javascript" src="/static/js/qrcode.min.js"></script><script type="text/javascript">new QRCode(document.getElementById("qrcode"), { text: "0x7B62EB7fe80350DC7EC945C0B73242cb9877FB1b", width: 160, height: 160 });</script></div></div><div class="row h-container"><h3 class="col-md-3">Transactions</h3><select class="col-md-2" style="background-color: #eaeaea;" onchange="self.location='?filter='+options[selectedIndex].value"><option>All</option><option  value="inputs">Address on input side</option><option  value="outputs">Address on output side</option><option  value="0">Non-contract</option><option  value="1">Internal</option><option  value="2">Contract 74</option><option  value="3">Contract 13</option><option  value="4">Contract 205</option></select><div class="col-md-7"><nav></nav></div></div><div class="data-div"><div class="alert alert-data"><div class="row line-bot"><div class="col-xs-7 col-md-8 ellipsis"><a href="/tx/0xca7628be5c80cda77163729ec63d218ee868a399d827a4682a478c6f48a6e22a">0xca7628be5c80cda77163729ec63d218ee868a399d827a4682a478c6f48a6e22a</a><span class="text-success"> ✔</span></div><div class="col-6">Method ID: 0x23b872dd</div></div><div class="row line-mid"><div class="col-md-4"><div class="row tx-in"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x837E3f699d85a4b0B99894567e9233dFB1DcB081">0x837E3f699d85a4b0B99894567e9233dFB1DcB081</a></span></td></tr></tbody></table></div></div><div class="col-md-1 col-xs-12 text-center"><svg class="octicon" viewBox="0 0 8 16"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path></svg></div><div class="col-md-4"><div class="row tx-out"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0xcdA9FC258358EcaA88845f19Af595e908bb7EfE9">0xcdA9FC258358EcaA88845f19Af595e908bb7EfE9</a></span></td></tr></tbody></table></div></div><div class="col-md-3 text-right" style="padding: .4rem 0;">0 FAKE</div></div><div class="row line-top" style="padding: 15px 0 6px 15px;font-weight: bold;">ERC721 Token Transfers</div><div class="row" style="padding: 2px 15px;"><div class="col-md-4"><div class="row tx-in"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x837E3f699d85a4b0B99894567e9233dFB1DcB081">0x837E3f699d85a4b0B99894567e9233dFB1DcB081</a></span></td></tr></tbody></table></div></div><div class="col-md-1 col-xs-12 text-center"><svg class="octicon" viewBox="0 0 8 16"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path></svg></div><div class="col-md-4"><div class="row tx-out"><table class="table data-table"><tbody><tr class="tx-own"><td><span class="ellipsis tx-addr">0x7B62EB7fe80350DC7EC945C0B73242cb9877FB1b</span></td></tr></tbody></table></div></div><div class="col-md-3 text-right" style="padding: .4rem 0;">ID 1 S205</div></div><div class="row" style="padding: 6px 15px;"></div><div class="row line-top"><div class="col-xs-6 col-sm-4 col-md-4"><span class="txvalues txvalues-default">Fee: 0.00008794500041041 FAKE</span></div><div class="col-xs-6 col-sm-8 col-md-8 text-right"><span class="txvalues txvalues-danger ng-hide">Unconfirmed Transaction!</span><span class="txvalues txvalues-primary">0 FAKE</span></div></div></div><div class="alert alert-data"><div class="row line-bot"><div class="col-xs-7 col-md-8 ellipsis"><a href="/tx/0xc92919ad24ffd58f760b18df7949f06e1190cf54a50a0e3745a385608ed3cbf2">0xc92919ad24ffd58f760b18df7949f06e1190cf54a50a0e3745a385608ed3cbf2</a><span class="text-success"> ✔</span></div><div class="col-6">Method ID: 0x4f150787</div></div><div class="row line-mid"><div class="col-md-4"><div class="row tx-in"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D">0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D</a></span></td></tr></tbody></table></div></div><div class="col-md-1 col-xs-12 text-center"><svg class="octicon" viewBox="0 0 8 16"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path></svg></div><div class="col-md-4"><div class="row tx-out"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x479CC461fEcd078F766eCc58533D6F69580CF3AC">0x479CC461fEcd078F766eCc58533D6F69580CF3AC</a></span></td></tr></tbody></table></div></div><div class="col-md-3 text-right" style="padding: .4rem 0;">0 FAKE</div></div><div class="row line-top" style="padding: 15px 0 6px 15px;font-weight: bold;">ERC20 Token Transfers</div><div class="row" style="padding: 2px 15px;"><div class="col-md-4"><div class="row tx-in"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x555Ee11FBDDc0E49A9bAB358A8941AD95fFDB48f">0x555Ee11FBDDc0E49A9bAB358A8941AD95fFDB48f</a></span></td></tr></tbody></table></div></div><div class="col-md-1 col-xs-12 text-center"><svg class="octicon" viewBox="0 0 8 16"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path></svg></div><div class="col-md-4"><div class="row tx-out"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D">0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D</a></span></td></tr></tbody></table></div></div><div class="col-md-3 text-right" style="padding: .4rem 0;">7.675000000000000001 S13</div></div><div class="row" style="padding: 2px 15px;"><div class="col-md-4"><div class="row tx-in"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D">0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D</a></span></td></tr></tbody></table></div></div><div class="col-md-1 col-xs-12 text-center"><svg class="octicon" viewBox="0 0 8 16"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path></svg></div><div class="col-md-4"><div class="row tx-out"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x555Ee11FBDDc0E49A9bAB358A8941AD95fFDB48f">0x555Ee11FBDDc0E49A9bAB358A8941AD95fFDB48f</a></span></td></tr></tbody></table></div></div><div class="col-md-3 text-right" style="padding: .4rem 0;">854.307892726464 S74</div></div><div class="row" style="padding: 2px 15px;"><div class="col-md-4"><div class="row tx-in"><table class="table data-table"><tbody><tr class="tx-own"><td><span class="ellipsis tx-addr">0x7B62EB7fe80350DC7EC945C0B73242cb9877FB1b</span></td></tr></tbody></table></div></div><div class="col-md-1 col-xs-12 text-center"><svg class="octicon" viewBox="0 0 8 16"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path></svg></div><div class="col-md-4"><div class="row tx-out"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D">0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D</a></span></td></tr></tbody></table></div></div><div class="col-md-3 text-right" style="padding: .4rem 0;">871.180000950184 S74</div></div><div class="row" style="padding: 2px 15px;"><div class="col-md-4"><div class="row tx-in"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D">0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D</a></span></td></tr></tbody></table></div></div><div class="col-md-1 col-xs-12 text-center"><svg class="octicon" viewBox="0 0 8 16"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path></svg></div><div class="col-md-4"><div class="row tx-out"><table class="table data-table"><tbody><tr class="tx-own"><td><span class="ellipsis tx-addr">0x7B62EB7fe80350DC7EC945C0B73242cb9877FB1b</span></td></tr></tbody></table></div></div><div class="col-md-3 text-right" style="padding: .4rem 0;">7.674999999999991915 S13</div></div><div class="row" style="padding: 6px 15px;"></div><div class="row line-top"><div class="col-xs-6 col-sm-4 col-md-4"><span class="txvalues txvalues-default">Fee: 0.000216368 FAKE</span></div><div class="col-xs-6 col-sm-8 col-md-8 text-right"><span class="txvalues txvalues-danger ng-hide">Unconfirmed Transaction!</span><span class="txvalues txvalues-primary">0 FAKE</span></div></div></div></div><nav></nav></div></main><footer id="footer" class="footer"><div class="container"><nav class="navbar navbar-expand-lg navbar-dark bg-trezor"><span class="navbar-nav"><a class="nav-link" href="https://satoshilabs.com/" target="_blank" rel="noopener noreferrer">© 2017-2022 SatoshiLabs</a></span><span class="navbar-nav ml-md-auto"><a class="nav-link" href="https://shop.trezor.io/static/shared/about/terms-of-use.pdf" target="_blank" rel="noopener noreferrer">Terms of Use</a></span><span class="navbar-nav ml-md-auto"><a class="nav-link" href="/sendtx">Send Transaction</a></span><span class="navbar-nav ml-md-auto d-md-flex d-none"><a class="nav-link active" href="http://shop.trezor.io" target="_blank" rel="noopener noreferrer">Don't have a Trezor? Get one!</a></span></nav></div></footer></body></html>`,
			},
		},
		{
			name:        "explorerAddress " + dbtestdata.EthAddr5d,
			r:           newGetRequest(ts.URL + "/address/" + dbtestdata.EthAddr5d),
			status:      http.StatusOK,
			contentType: "text/html; charset=utf-8",
			body: []string{
				`<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"><link rel="stylesheet" href="/static/css/main.css"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="Trezor Fake Coin Explorer"><title>Trezor Fake Coin Explorer</title></head><body><header id="header"><div class="container"><nav class="navbar navbar-expand-md navbar-dark bg-trezor"><a class="navbar-brand" href="/" title="Home"><div alt="Trezor Wallet" style="margin-top: 3px;"><svg width="100" version="1.1" id="logotyp" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 163.7 41.9" space="preserve"><polygon points="101.1,12.8 118.2,12.8 118.2,17.3 108.9,29.9 118.2,29.9 118.2,35.2 101.1,35.2 101.1,30.7 110.4,18.1 101.1,18.1"></polygon><path d="M158.8,26.9c2.1-0.8,4.3-2.9,4.3-6.6c0-4.5-3.1-7.4-7.7-7.4h-10.5v22.3h5.8v-7.5h2.2l4.1,7.5h6.7L158.8,26.9z M154.7,22.5h-4V18h4c1.5,0,2.5,0.9,2.5,2.2C157.2,21.6,156.2,22.5,154.7,22.5z"></path><path d="M130.8,12.5c-6.8,0-11.6,4.9-11.6,11.5s4.9,11.5,11.6,11.5s11.7-4.9,11.7-11.5S137.6,12.5,130.8,12.5z M130.8,30.3c-3.4,0-5.7-2.6-5.7-6.3c0-3.8,2.3-6.3,5.7-6.3c3.4,0,5.8,2.6,5.8,6.3C136.6,27.7,134.2,30.3,130.8,30.3z"></path><polygon points="82.1,12.8 98.3,12.8 98.3,18 87.9,18 87.9,21.3 98,21.3 98,26.4 87.9,26.4 87.9,30 98.3,30 98.3,35.2 82.1,35.2"></polygon><path d="M24.6,9.7C24.6,4.4,20,0,14.4,0S4.2,4.4,4.2,9.7v3.1H0v22.3h0l14.4,6.7l14.4-6.7h0V12.9h-4.2V9.7z M9.4,9.7c0-2.5,2.2-4.5,5-4.5s5,2,5,4.5v3.1H9.4V9.7z M23,31.5l-8.6,4l-8.6-4V18.1H23V31.5z"></path><path d="M79.4,20.3c0-4.5-3.1-7.4-7.7-7.4H61.2v22.3H67v-7.5h2.2l4.1,7.5H80l-4.9-8.3C77.2,26.1,79.4,24,79.4,20.3z M71,22.5h-4V18h4c1.5,0,2.5,0.9,2.5,2.2C73.5,21.6,72.5,22.5,71,22.5z"></path><polygon points="40.5,12.8 58.6,12.8 58.6,18.1 52.4,18.1 52.4,35.2 46.6,35.2 46.6,18.1 40.5,18.1"></polygon></svg></div></a><a class="navbar-brand" href="/">Fake Coin Explorer</a><button class="navbar-toggler" type="button" onclick="if(document.getElementById('toggler').className.indexOf('show')>0){document.getElementById('toggler').className='navbar-collapse collapse'}else{document.getElementById('toggler').className='navbar-collapse show'}"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="toggler"><ul class="navbar-nav ml-md-auto"><li class="nav-item"><a href="/blocks" class="nav-link">Blocks</a></li><li class="nav-item"><a href="/" class="nav-link">Status</a></li></ul><span class="navbar-form ml-md-auto"><form id="search" action="/search" method="get"><input name="q" type="text" class="form-control" placeholder="Search for block, transaction, address or xpub" focus="true"></form></span><ul class="navbar-nav ml-md-auto"><li class="nav-item"><a class="nav-link" href="https://trezor.io/" target="_blank" rel="noopener noreferrer">Trezor</a></li><li class="nav-item"><a class="nav-link" href="https://suite.trezor.io/" target="_blank" rel="noopener noreferrer">Suite</a></li><li class="nav-item"><a class="nav-link" href="https://trezor.io/support" target="_blank" rel="noopener noreferrer">Support</a></li></ul></div></nav></div></header><main id="wrap"><div class="container"><h1>Address <small class="text-muted">0.000000000123450093 FAKE</small></h1><div class="alert alert-data ellipsis"><span class="data">0x5Dc6288b35E0807A3d6fEB89b3a2Ff4aB773168e</span></div><h3>Confirmed</h3><div class="data-div row"><div class="col-lg-10"><table class="table data-table"><tbody><tr><td style="width: 25%;">Balance</td><td class="data">0.000000000123450093 FAKE</td></tr><tr><td>Transactions</td><td class="data">1</td></tr><tr><td>Non-contract Transactions</td><td class="data">1</td></tr><tr><td>Internal Transactions</td><td class="data">0</td></tr><tr><td>Nonce</td><td class="data">93</td></tr><tr><td>ERC1155 Tokens</td><td style="padding: 0;"><table class="table data-table"><tbody><tr><th>Contract</th><th>Tokens</th><th style="width: 15%;">Transfers</th></tr><tr><td class="data ellipsis"><a href="/address/0x6Fd712E3A5B556654044608F9129040A4839E36c">Contract 111</a></td><td class="data">1776:1 S111, 1898:10 S111</td><td class="data">1</td></tr></tbody></table></td></tr></tr></tbody></table></div><div class="col-lg-2"><div id="qrcode" style="width: 160px; height: 160px; float: right; padding-left: 10px;"></div><script type="text/javascript" src="/static/js/qrcode.min.js"></script><script type="text/javascript">new QRCode(document.getElementById("qrcode"), { text: "0x5Dc6288b35E0807A3d6fEB89b3a2Ff4aB773168e", width: 160, height: 160 });</script></div></div><div class="row h-container"><h3 class="col-md-3">Transactions</h3><select class="col-md-2" style="background-color: #eaeaea;" onchange="self.location='?filter='+options[selectedIndex].value"><option>All</option><option  value="inputs">Address on input side</option><option  value="outputs">Address on output side</option><option  value="0">Non-contract</option><option  value="1">Internal</option><option  value="2">Contract 111</option></select><div class="col-md-7"><nav></nav></div></div><div class="data-div"><div class="alert alert-data"><div class="row line-bot"><div class="col-xs-7 col-md-8 ellipsis"><a href="/tx/0x6942c79c04ae981a2d194deb0ae5ae5e9d5d7a90fd9f52246b162fa645155e3a">0x6942c79c04ae981a2d194deb0ae5ae5e9d5d7a90fd9f52246b162fa645155e3a</a><span class="text-success"> ✔</span></div><div class="col-6">Method ID: 0x78627919</div></div><div class="row line-mid"><div class="col-md-4"><div class="row tx-in"><table class="table data-table"><tbody><tr class="tx-own"><td><span class="ellipsis tx-addr">0x5Dc6288b35E0807A3d6fEB89b3a2Ff4aB773168e</span></td></tr></tbody></table></div></div><div class="col-md-1 col-xs-12 text-center"><svg class="octicon" viewBox="0 0 8 16"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path></svg></div><div class="col-md-4"><div class="row tx-out"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x6Fd712E3A5B556654044608F9129040A4839E36c">0x6Fd712E3A5B556654044608F9129040A4839E36c</a></span></td></tr></tbody></table></div></div><div class="col-md-3 text-right" style="padding: .4rem 0;">0 FAKE</div></div><div class="row line-top" style="padding: 15px 0 6px 15px;font-weight: bold;">ERC1155 Token Transfers</div><div class="row" style="padding: 2px 15px;"><div class="col-md-4"><div class="row tx-in"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x0000000000000000000000000000000000000000">0x0000000000000000000000000000000000000000</a></span></td></tr></tbody></table></div></div><div class="col-md-1 col-xs-12 text-center"><svg class="octicon" viewBox="0 0 8 16"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path></svg></div><div class="col-md-4"><div class="row tx-out"><table class="table data-table"><tbody><tr class="tx-own"><td><span class="ellipsis tx-addr">0x5Dc6288b35E0807A3d6fEB89b3a2Ff4aB773168e</span></td></tr></tbody></table></div></div><div class="col-md-3 text-right" style="padding: .4rem 0;">1776:1 S1111898:10 S111</div></div><div class="row" style="padding: 6px 15px;"></div><div class="row line-top"><div class="col-xs-6 col-sm-4 col-md-4"><span class="txvalues txvalues-default">Fee: 0.000081891755740665 FAKE</span></div><div class="col-xs-6 col-sm-8 col-md-8 text-right"><span class="txvalues txvalues-danger ng-hide">Unconfirmed Transaction!</span><span class="txvalues txvalues-primary">0 FAKE</span></div></div></div></div><nav></nav></div></main><footer id="footer" class="footer"><div class="container"><nav class="navbar navbar-expand-lg navbar-dark bg-trezor"><span class="navbar-nav"><a class="nav-link" href="https://satoshilabs.com/" target="_blank" rel="noopener noreferrer">© 2017-2022 SatoshiLabs</a></span><span class="navbar-nav ml-md-auto"><a class="nav-link" href="https://shop.trezor.io/static/shared/about/terms-of-use.pdf" target="_blank" rel="noopener noreferrer">Terms of Use</a></span><span class="navbar-nav ml-md-auto"><a class="nav-link" href="/sendtx">Send Transaction</a></span><span class="navbar-nav ml-md-auto d-md-flex d-none"><a class="nav-link active" href="http://shop.trezor.io" target="_blank" rel="noopener noreferrer">Don't have a Trezor? Get one!</a></span></nav></div></footer></body></html>`,
			},
		},
		{
			name:        "explorerTx " + dbtestdata.EthTxidB1T2,
			r:           newGetRequest(ts.URL + "/tx/0x" + dbtestdata.EthTxidB1T2),
			status:      http.StatusOK,
			contentType: "text/html; charset=utf-8",
			body: []string{
				`<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"><link rel="stylesheet" href="/static/css/main.css"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="Trezor Fake Coin Explorer"><title>Trezor Fake Coin Explorer</title></head><body><header id="header"><div class="container"><nav class="navbar navbar-expand-md navbar-dark bg-trezor"><a class="navbar-brand" href="/" title="Home"><div alt="Trezor Wallet" style="margin-top: 3px;"><svg width="100" version="1.1" id="logotyp" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 163.7 41.9" space="preserve"><polygon points="101.1,12.8 118.2,12.8 118.2,17.3 108.9,29.9 118.2,29.9 118.2,35.2 101.1,35.2 101.1,30.7 110.4,18.1 101.1,18.1"></polygon><path d="M158.8,26.9c2.1-0.8,4.3-2.9,4.3-6.6c0-4.5-3.1-7.4-7.7-7.4h-10.5v22.3h5.8v-7.5h2.2l4.1,7.5h6.7L158.8,26.9z M154.7,22.5h-4V18h4c1.5,0,2.5,0.9,2.5,2.2C157.2,21.6,156.2,22.5,154.7,22.5z"></path><path d="M130.8,12.5c-6.8,0-11.6,4.9-11.6,11.5s4.9,11.5,11.6,11.5s11.7-4.9,11.7-11.5S137.6,12.5,130.8,12.5z M130.8,30.3c-3.4,0-5.7-2.6-5.7-6.3c0-3.8,2.3-6.3,5.7-6.3c3.4,0,5.8,2.6,5.8,6.3C136.6,27.7,134.2,30.3,130.8,30.3z"></path><polygon points="82.1,12.8 98.3,12.8 98.3,18 87.9,18 87.9,21.3 98,21.3 98,26.4 87.9,26.4 87.9,30 98.3,30 98.3,35.2 82.1,35.2"></polygon><path d="M24.6,9.7C24.6,4.4,20,0,14.4,0S4.2,4.4,4.2,9.7v3.1H0v22.3h0l14.4,6.7l14.4-6.7h0V12.9h-4.2V9.7z M9.4,9.7c0-2.5,2.2-4.5,5-4.5s5,2,5,4.5v3.1H9.4V9.7z M23,31.5l-8.6,4l-8.6-4V18.1H23V31.5z"></path><path d="M79.4,20.3c0-4.5-3.1-7.4-7.7-7.4H61.2v22.3H67v-7.5h2.2l4.1,7.5H80l-4.9-8.3C77.2,26.1,79.4,24,79.4,20.3z M71,22.5h-4V18h4c1.5,0,2.5,0.9,2.5,2.2C73.5,21.6,72.5,22.5,71,22.5z"></path><polygon points="40.5,12.8 58.6,12.8 58.6,18.1 52.4,18.1 52.4,35.2 46.6,35.2 46.6,18.1 40.5,18.1"></polygon></svg></div></a><a class="navbar-brand" href="/">Fake Coin Explorer</a><button class="navbar-toggler" type="button" onclick="if(document.getElementById('toggler').className.indexOf('show')>0){document.getElementById('toggler').className='navbar-collapse collapse'}else{document.getElementById('toggler').className='navbar-collapse show'}"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="toggler"><ul class="navbar-nav ml-md-auto"><li class="nav-item"><a href="/blocks" class="nav-link">Blocks</a></li><li class="nav-item"><a href="/" class="nav-link">Status</a></li></ul><span class="navbar-form ml-md-auto"><form id="search" action="/search" method="get"><input name="q" type="text" class="form-control" placeholder="Search for block, transaction, address or xpub" focus="true"></form></span><ul class="navbar-nav ml-md-auto"><li class="nav-item"><a class="nav-link" href="https://trezor.io/" target="_blank" rel="noopener noreferrer">Trezor</a></li><li class="nav-item"><a class="nav-link" href="https://suite.trezor.io/" target="_blank" rel="noopener noreferrer">Suite</a></li><li class="nav-item"><a class="nav-link" href="https://trezor.io/support" target="_blank" rel="noopener noreferrer">Support</a></li></ul></div></nav></div></header><main id="wrap"><div class="container"><h1>Transaction</h1><div class="alert alert-data ellipsis"><span class="data">0xa9cd088aba2131000da6f38a33c20169baee476218deea6b78720700b895b101</span></div><h3>Summary</h3><div class="data-div"><table class="table data-table"><tbody><tr><td style="width: 25%;">In Block</td><td class="ellipsis data">Unconfirmed</td></tr><tr><td>Status</td><td class="data text-success">Success</td></tr><tr><td>Value</td><td class="data">0 FAKE</td></tr><tr><td>Gas Used / Limit</td><td class="data">52025 / 78037</td></tr><tr><td>Gas Price</td><td class="data">0.00000004 FAKE</td></tr><tr><td>Fees</td><td class="data">0.002081 FAKE</td></tr><tr><td><span title="Replace by fee">RBF</span></td><td class="data"><span title="Replace by fee transaction, could be replaced.">ON</span></td></tr></tbody></table></div><h3>Details</h3><div class="data-div"><div class="alert alert-data"><div class="row line-bot"><div class="col-xs-7 col-md-8 ellipsis"><a href="/tx/0xa9cd088aba2131000da6f38a33c20169baee476218deea6b78720700b895b101">0xa9cd088aba2131000da6f38a33c20169baee476218deea6b78720700b895b101</a><span class="text-success"> ✔</span></div><div class="col-6">Transfer</div><div class="col-6">Method ID: 0xa9059cbb</div></div><div class="row line-mid"><div class="col-md-4"><div class="row tx-in"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x20cD153de35D469BA46127A0C8F18626b59a256A">0x20cD153de35D469BA46127A0C8F18626b59a256A</a></span></td></tr></tbody></table></div></div><div class="col-md-1 col-xs-12 text-center"><svg class="octicon" viewBox="0 0 8 16"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path></svg></div><div class="col-md-4"><div class="row tx-out"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x4af4114F73d1c1C903aC9E0361b379D1291808A2">0x4af4114F73d1c1C903aC9E0361b379D1291808A2</a></span></td></tr></tbody></table></div></div><div class="col-md-3 text-right" style="padding: .4rem 0;">0 FAKE</div></div><div class="row line-top" style="padding: 15px 0 6px 15px;font-weight: bold;">ERC20 Token Transfers</div><div class="row" style="padding: 2px 15px;"><div class="col-md-4"><div class="row tx-in"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x20cD153de35D469BA46127A0C8F18626b59a256A">0x20cD153de35D469BA46127A0C8F18626b59a256A</a></span></td></tr></tbody></table></div></div><div class="col-md-1 col-xs-12 text-center"><svg class="octicon" viewBox="0 0 8 16"><path fill-rule="evenodd" d="M7.5 8l-5 5L1 11.5 4.75 8 1 4.5 2.5 3l5 5z"></path></svg></div><div class="col-md-4"><div class="row tx-out"><table class="table data-table"><tbody><tr><td><span class="ellipsis tx-addr"><a href="/address/0x555Ee11FBDDc0E49A9bAB358A8941AD95fFDB48f">0x555Ee11FBDDc0E49A9bAB358A8941AD95fFDB48f</a></span></td></tr></tbody></table></div></div><div class="col-md-3 text-right" style="padding: .4rem 0;">10000000000 S74</div></div><div class="row" style="padding: 6px 15px;"></div><div class="row line-top"><div class="col-xs-6 col-sm-4 col-md-4"><span class="txvalues txvalues-default">Fee: 0.002081 FAKE</span></div><div class="col-xs-6 col-sm-8 col-md-8 text-right"><span class="txvalues txvalues-danger ng-hide">Unconfirmed Transaction!</span><span class="txvalues txvalues-primary">0 FAKE</span></div></div></div></div><div class="data-div"><h5>Input Data</h5><div class="row"><div class="col-6">Transfer</div><div class="col-6">Method ID: 0xa9059cbb</div><div class="col-12">Function: transfer(address, uint256)</div><div class="col-12"><table class="table data-table"><thead><tr><th style="width: 5%;">#</th><th>Type</th><th>Data</th></tr></thead><tbody><tr><td>0</td><td>address</td><td><a href="/address/0x555Ee11FBDDc0E49A9bAB358A8941AD95fFDB48f">0x555Ee11FBDDc0E49A9bAB358A8941AD95fFDB48f</a></td></tr><tr><td>1</td><td>uint256</td><td>10000000000000000000000</td></tr></tbody></table></div></div></div><div class="data-div"><h5>Raw Transaction</h5><div class="alert alert-data" style="word-wrap: break-word; font-size: smaller;"><pre id="txSpecific"></pre></div><script type="text/javascript">txSpecific = {"tx":{"nonce":"0xd0","gasPrice":"0x9502f9000","gas":"0x130d5","to":"0x4af4114F73d1c1C903aC9E0361b379D1291808A2","value":"0x0","input":"0xa9059cbb000000000000000000000000555ee11fbddc0e49a9bab358a8941ad95ffdb48f00000000000000000000000000000000000000000000021e19e0c9bab2400000","hash":"0xa9cd088aba2131000da6f38a33c20169baee476218deea6b78720700b895b101","blockNumber":"0x41eee8","from":"0x20cD153de35D469BA46127A0C8F18626b59a256A","transactionIndex":"0x0"},"internalData":{"type":0,"transfers":[{"type":1,"from":"9f4981531fda132e83c44680787dfa7ee31e4f8d","to":"4af4114f73d1c1c903ac9e0361b379d1291808a2","value":1000000},{"type":0,"from":"3e3a3d69dc66ba10737f531ed088954a9ec89d97","to":"9f4981531fda132e83c44680787dfa7ee31e4f8d","value":1000001},{"type":0,"from":"3e3a3d69dc66ba10737f531ed088954a9ec89d97","to":"3e3a3d69dc66ba10737f531ed088954a9ec89d97","value":1000002}],"Error":""},"receipt":{"gasUsed":"0xcb39","status":"0x1","logs":[{"address":"0x4af4114F73d1c1C903aC9E0361b379D1291808A2","topics":["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x00000000000000000000000020cd153de35d469ba46127a0c8f18626b59a256a","0x000000000000000000000000555ee11fbddc0e49a9bab358a8941ad95ffdb48f"],"data":"0x00000000000000000000000000000000000000000000021e19e0c9bab2400000"}]}};function syntaxHighlight(json) {json = JSON.stringify(json, undefined, 2);json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {var cls = 'number';if (/^"/.test(match)) {if (/:$/.test(match)) {cls = 'key';} else {cls = 'string';}} else if (/true|false/.test(match)) {cls = 'boolean';} else if (/null/.test(match)) {cls = 'null';}return '<span class="' + cls + '">' + match + '</span>';});}document.getElementById('txSpecific').innerHTML = syntaxHighlight(txSpecific);</script></div></div></main><footer id="footer" class="footer"><div class="container"><nav class="navbar navbar-expand-lg navbar-dark bg-trezor"><span class="navbar-nav"><a class="nav-link" href="https://satoshilabs.com/" target="_blank" rel="noopener noreferrer">© 2017-2022 SatoshiLabs</a></span><span class="navbar-nav ml-md-auto"><a class="nav-link" href="https://shop.trezor.io/static/shared/about/terms-of-use.pdf" target="_blank" rel="noopener noreferrer">Terms of Use</a></span><span class="navbar-nav ml-md-auto"><a class="nav-link" href="/sendtx">Send Transaction</a></span><span class="navbar-nav ml-md-auto d-md-flex d-none"><a class="nav-link active" href="http://shop.trezor.io" target="_blank" rel="noopener noreferrer">Don't have a Trezor? Get one!</a></span></nav></div></footer></body></html>`,
			},
		},
		{
			name:        "apiIndex",
			r:           newGetRequest(ts.URL + "/api"),
			status:      http.StatusOK,
			contentType: "application/json; charset=utf-8",
			body: []string{
				`{"blockbook":{"coin":"Fakecoin"`,
				`"bestHeight":4321001`,
				`"decimals":18`,
				`"backend":{"chain":"fakecoin","blocks":2,"headers":2,"bestBlockHash":"0x2b57e15e93a0ed197417a34c2498b7187df79099572c04a6b6e6ff418f74e6ee"`,
				`"version":"001001","subversion":"/Fakecoin:0.0.1/"`,
			},
		},
		{
			name:        "apiAddress EthAddr4b",
			r:           newGetRequest(ts.URL + "/api/v2/address/" + dbtestdata.EthAddr4b),
			status:      http.StatusOK,
			contentType: "application/json; charset=utf-8",
			body: []string{
				`{"page":1,"totalPages":1,"itemsOnPage":1000,"address":"0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D","balance":"123450075","unconfirmedBalance":"0","unconfirmedTxs":0,"txs":1,"nonTokenTxs":1,"internalTxs":1,"txids":["0xc92919ad24ffd58f760b18df7949f06e1190cf54a50a0e3745a385608ed3cbf2"],"nonce":"75","tokens":[{"type":"ERC20","name":"Contract 13","contract":"0x0d0F936Ee4c93e25944694D6C121de94D9760F11","transfers":2,"symbol":"S13","decimals":18,"balance":"1000075013"},{"type":"ERC20","name":"Contract 74","contract":"0x4af4114F73d1c1C903aC9E0361b379D1291808A2","transfers":2,"symbol":"S74","decimals":12,"balance":"1000075074"}]}`,
			},
		},
		{
			name:        "apiAddress EthAddr7b details=txs",
			r:           newGetRequest(ts.URL + "/api/v2/address/" + dbtestdata.EthAddr7b + "?details=txs"),
			status:      http.StatusOK,
			contentType: "application/json; charset=utf-8",
			body: []string{
				`{"page":1,"totalPages":1,"itemsOnPage":1000,"address":"0x7B62EB7fe80350DC7EC945C0B73242cb9877FB1b","balance":"123450123","unconfirmedBalance":"0","unconfirmedTxs":0,"txs":2,"transactions":[{"txid":"0xca7628be5c80cda77163729ec63d218ee868a399d827a4682a478c6f48a6e22a","vin":[{"n":0,"addresses":["0x837E3f699d85a4b0B99894567e9233dFB1DcB081"],"isAddress":true}],"vout":[{"value":"0","n":0,"addresses":["0xcdA9FC258358EcaA88845f19Af595e908bb7EfE9"],"isAddress":true}],"blockHeight":-1,"confirmations":0,"blockTime":0,"value":"0","fees":"87945000410410","rbf":true,"coinSpecificData":{"tx":{"nonce":"0x2","gasPrice":"0x59682f07","gas":"0x173a9","to":"0xcdA9FC258358EcaA88845f19Af595e908bb7EfE9","value":"0x0","input":"0x23b872dd000000000000000000000000837e3f699d85a4b0b99894567e9233dfb1dcb0810000000000000000000000007b62eb7fe80350dc7ec945c0b73242cb9877fb1b0000000000000000000000000000000000000000000000000000000000000001","hash":"0xca7628be5c80cda77163729ec63d218ee868a399d827a4682a478c6f48a6e22a","blockNumber":"0xb33b9f","from":"0x837E3f699d85a4b0B99894567e9233dFB1DcB081","transactionIndex":"0x1"},"receipt":{"gasUsed":"0xe506","status":"0x1","logs":[{"address":"0xcdA9FC258358EcaA88845f19Af595e908bb7EfE9","topics":["0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925","0x000000000000000000000000837e3f699d85a4b0b99894567e9233dfb1dcb081","0x0000000000000000000000000000000000000000000000000000000000000000","0x0000000000000000000000000000000000000000000000000000000000000001"],"data":"0x"},{"address":"0xcdA9FC258358EcaA88845f19Af595e908bb7EfE9","topics":["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x000000000000000000000000837e3f699d85a4b0b99894567e9233dfb1dcb081","0x0000000000000000000000007b62eb7fe80350dc7ec945c0b73242cb9877fb1b","0x0000000000000000000000000000000000000000000000000000000000000001"],"data":"0x"}]}},"tokenTransfers":[{"type":"ERC721","from":"0x837E3f699d85a4b0B99894567e9233dFB1DcB081","to":"0x7B62EB7fe80350DC7EC945C0B73242cb9877FB1b","token":"0xcdA9FC258358EcaA88845f19Af595e908bb7EfE9","name":"Contract 205","symbol":"S205","decimals":18,"value":"1"}],"ethereumSpecific":{"status":1,"nonce":2,"gasLimit":95145,"gasUsed":58630,"gasPrice":"1500000007","data":"0x23b872dd000000000000000000000000837e3f699d85a4b0b99894567e9233dfb1dcb0810000000000000000000000007b62eb7fe80350dc7ec945c0b73242cb9877fb1b0000000000000000000000000000000000000000000000000000000000000001","parsedData":{"methodId":"0x23b872dd","name":""}}},{"txid":"0xc92919ad24ffd58f760b18df7949f06e1190cf54a50a0e3745a385608ed3cbf2","vin":[{"n":0,"addresses":["0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D"],"isAddress":true}],"vout":[{"value":"0","n":0,"addresses":["0x479CC461fEcd078F766eCc58533D6F69580CF3AC"],"isAddress":true}],"blockHeight":-1,"confirmations":0,"blockTime":0,"value":"0","fees":"216368000000000","rbf":true,"coinSpecificData":{"tx":{"nonce":"0x1df76","gasPrice":"0x3b9aca00","gas":"0x3d090","to":"0x479CC461fEcd078F766eCc58533D6F69580CF3AC","value":"0x0","input":"0x4f15078700000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000420000000000000000000000000000000000000000000000000000000000000048000000000000000000000000000000000000000000000000000000000000004e00000000000000000000000000000000000000000000000000000000000000002000000000000000000000000555ee11fbddc0e49a9bab358a8941ad95ffdb48f0000000000000000000000004bda106325c335df99eab7fe363cac8a0ba2a24d0000000000000000000000000d0f936ee4c93e25944694d6c121de94d9760f110000000000000000000000004af4114f73d1c1c903ac9e0361b379d1291808a200000000000000000000000000000000000000000000000000000000000000000000000000000000000000007b62eb7fe80350dc7ec945c0b73242cb9877fb1b0000000000000000000000004bda106325c335df99eab7fe363cac8a0ba2a24d0000000000000000000000004af4114f73d1c1c903ac9e0361b379d1291808a20000000000000000000000000d0f936ee4c93e25944694d6c121de94d9760f110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000a5ef5a7656bfb0000000000000000000000000000000000000000000000000000004ba78398d5c5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000166cfe0b9579b4ecf7a2801880f644009a324671a79754ea57c3a103c6e70d3dbef6ba69a08000000000000000000000000000000000000000000000000004f937d86afb90000000000000000000000000000000000000000000000000ab280fd8037d500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000166cfb784b7c1f3fbe8b75484603ab8adc58aaee3a46245a6579fac7077b5570018b4e0d4eb0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000308fd0e798ac00000000000000000000000000000000000000000000000006a8313d60b1f606b0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001b000000000000000000000000000000000000000000000000000000000000001b00000000000000000000000000000000000000000000000000000000000000029de0ccec59e8948e3d905b40e5542335ebc1eb4674db517d2f6392ec7fdeb3d45f3449d313ee2589819c6c79eb1c1b047adae68565c1608e3a1d1d70823febb0000000000000000000000000000000000000000000000000000000000000000234d06fe17f1202e8b07177a30eb64d14adc08cdb3fa1b3e3e0bea0f9672c02175b77c01c51d3c7e460723b27ecbc7801fd6482559a8c9999593f9a4d149c7384","hash":"0xc92919ad24ffd58f760b18df7949f06e1190cf54a50a0e3745a385608ed3cbf2","blockNumber":"0x41eee9","from":"0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D","transactionIndex":"0x24"},"internalData":{"type":1,"contract":"0d0f936ee4c93e25944694d6c121de94d9760f11","transfers":[{"type":0,"from":"4bda106325c335df99eab7fe363cac8a0ba2a24d","to":"9f4981531fda132e83c44680787dfa7ee31e4f8d","value":1000010},{"type":2,"from":"4af4114f73d1c1c903ac9e0361b379d1291808a2","to":"9f4981531fda132e83c44680787dfa7ee31e4f8d","value":1000011}],"Error":""},"receipt":{"gasUsed":"0x34d30","status":"0x1","logs":[{"address":"0x0d0F936Ee4c93e25944694D6C121de94D9760F11","topics":["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x000000000000000000000000555ee11fbddc0e49a9bab358a8941ad95ffdb48f","0x0000000000000000000000004bda106325c335df99eab7fe363cac8a0ba2a24d"],"data":"0x0000000000000000000000000000000000000000000000006a8313d60b1f8001"},{"address":"0x4af4114F73d1c1C903aC9E0361b379D1291808A2","topics":["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x0000000000000000000000004bda106325c335df99eab7fe363cac8a0ba2a24d","0x000000000000000000000000555ee11fbddc0e49a9bab358a8941ad95ffdb48f"],"data":"0x000000000000000000000000000000000000000000000000000308fd0e798ac0"},{"address":"0x479CC461fEcd078F766eCc58533D6F69580CF3AC","topics":["0x0d0b9391970d9a25552f37d436d2aae2925e2bfe1b2a923754bada030c498cb3","0x000000000000000000000000555ee11fbddc0e49a9bab358a8941ad95ffdb48f","0x0000000000000000000000000000000000000000000000000000000000000000","0x5af266c0a89a07c1917deaa024414577e6c3c31c8907d079e13eb448c082594f"],"data":"0x0000000000000000000000004bda106325c335df99eab7fe363cac8a0ba2a24d0000000000000000000000000d0f936ee4c93e25944694d6c121de94d9760f110000000000000000000000004af4114f73d1c1c903ac9e0361b379d1291808a20000000000000000000000000000000000000000000000006a8313d60b1f8001000000000000000000000000000000000000000000000000000308fd0e798ac0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005e083a16f4b092c5729a49f9c3ed3cc171bb3d3d0c22e20b1de6063c32f399ac"},{"address":"0x4af4114F73d1c1C903aC9E0361b379D1291808A2","topics":["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x0000000000000000000000007b62eb7fe80350dc7ec945c0b73242cb9877fb1b","0x0000000000000000000000004bda106325c335df99eab7fe363cac8a0ba2a24d"],"data":"0x00000000000000000000000000000000000000000000000000031855667df7a8"},{"address":"0x0d0F936Ee4c93e25944694D6C121de94D9760F11","topics":["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x0000000000000000000000004bda106325c335df99eab7fe363cac8a0ba2a24d","0x0000000000000000000000007b62eb7fe80350dc7ec945c0b73242cb9877fb1b"],"data":"0x0000000000000000000000000000000000000000000000006a8313d60b1f606b"},{"address":"0x479CC461fEcd078F766eCc58533D6F69580CF3AC","topics":["0x0d0b9391970d9a25552f37d436d2aae2925e2bfe1b2a923754bada030c498cb3","0x0000000000000000000000007b62eb7fe80350dc7ec945c0b73242cb9877fb1b","0x0000000000000000000000000000000000000000000000000000000000000000","0xb0b69dad58df6032c3b266e19b1045b19c87acd2c06fb0c598090f44b8e263aa"],"data":"0x0000000000000000000000004bda106325c335df99eab7fe363cac8a0ba2a24d0000000000000000000000004af4114f73d1c1c903ac9e0361b379d1291808a20000000000000000000000000d0f936ee4c93e25944694d6c121de94d9760f1100000000000000000000000000000000000000000000000000031855667df7a80000000000000000000000000000000000000000000000006a8313d60b1f606b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f2b0d62c44ed08f2a5adef40c875d20310a42a9d4f488bd26323256fe01c7f48"}]}},"tokenTransfers":[{"type":"ERC20","from":"0x555Ee11FBDDc0E49A9bAB358A8941AD95fFDB48f","to":"0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D","token":"0x0d0F936Ee4c93e25944694D6C121de94D9760F11","name":"Contract 13","symbol":"S13","decimals":18,"value":"7675000000000000001"},{"type":"ERC20","from":"0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D","to":"0x555Ee11FBDDc0E49A9bAB358A8941AD95fFDB48f","token":"0x4af4114F73d1c1C903aC9E0361b379D1291808A2","name":"Contract 74","symbol":"S74","decimals":12,"value":"854307892726464"},{"type":"ERC20","from":"0x7B62EB7fe80350DC7EC945C0B73242cb9877FB1b","to":"0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D","token":"0x4af4114F73d1c1C903aC9E0361b379D1291808A2","name":"Contract 74","symbol":"S74","decimals":12,"value":"871180000950184"},{"type":"ERC20","from":"0x4Bda106325C335dF99eab7fE363cAC8A0ba2a24D","to":"0x7B62EB7fe80350DC7EC945C0B73242cb9877FB1b","token":"0x0d0F936Ee4c93e25944694D6C121de94D9760F11","name":"Contract 13","symbol":"S13","decimals":18,"value":"7674999999999991915"}],"ethereumSpecific":{"status":1,"nonce":122742,"gasLimit":250000,"gasUsed":216368,"gasPrice":"1000000000","data":"0x4f15078700000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000420000000000000000000000000000000000000000000000000000000000000048000000000000000000000000000000000000000000000000000000000000004e00000000000000000000000000000000000000000000000000000000000000002000000000000000000000000555ee11fbddc0e49a9bab358a8941ad95ffdb48f0000000000000000000000004bda106325c335df99eab7fe363cac8a0ba2a24d0000000000000000000000000d0f936ee4c93e25944694d6c121de94d9760f110000000000000000000000004af4114f73d1c1c903ac9e0361b379d1291808a200000000000000000000000000000000000000000000000000000000000000000000000000000000000000007b62eb7fe80350dc7ec945c0b73242cb9877fb1b0000000000000000000000004bda106325c335df99eab7fe363cac8a0ba2a24d0000000000000000000000004af4114f73d1c1c903ac9e0361b379d1291808a20000000000000000000000000d0f936ee4c93e25944694d6c121de94d9760f110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000a5ef5a7656bfb0000000000000000000000000000000000000000000000000000004ba78398d5c5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000166cfe0b9579b4ecf7a2801880f644009a324671a79754ea57c3a103c6e70d3dbef6ba69a08000000000000000000000000000000000000000000000000004f937d86afb90000000000000000000000000000000000000000000000000ab280fd8037d500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000166cfb784b7c1f3fbe8b75484603ab8adc58aaee3a46245a6579fac7077b5570018b4e0d4eb0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000308fd0e798ac00000000000000000000000000000000000000000000000006a8313d60b1f606b0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001b000000000000000000000000000000000000000000000000000000000000001b00000000000000000000000000000000000000000000000000000000000000029de0ccec59e8948e3d905b40e5542335ebc1eb4674db517d2f6392ec7fdeb3d45f3449d313ee2589819c6c79eb1c1b047adae68565c1608e3a1d1d70823febb0000000000000000000000000000000000000000000000000000000000000000234d06fe17f1202e8b07177a30eb64d14adc08cdb3fa1b3e3e0bea0f9672c02175b77c01c51d3c7e460723b27ecbc7801fd6482559a8c9999593f9a4d149c7384","parsedData":{"methodId":"0x4f150787","name":""}}}],"nonce":"123","tokens":[{"type":"ERC20","name":"Contract 74","contract":"0x4af4114F73d1c1C903aC9E0361b379D1291808A2","transfers":1,"symbol":"S74","decimals":12,"balance":"1000123074"},{"type":"ERC20","name":"Contract 13","contract":"0x0d0F936Ee4c93e25944694D6C121de94D9760F11","transfers":1,"symbol":"S13","decimals":18,"balance":"1000123013"},{"type":"ERC721","name":"Contract 205","contract":"0xcdA9FC258358EcaA88845f19Af595e908bb7EfE9","transfers":1,"symbol":"S205","decimals":18,"ids":["1"]}],"addressAliases":{"0x7B62EB7fe80350DC7EC945C0B73242cb9877FB1b":{"Type":"ENS","Alias":"address7b.eth"},"0xcdA9FC258358EcaA88845f19Af595e908bb7EfE9":{"Type":"Contract","Alias":"Contract 205"}}}`,
			},
		},
		{
			name:        "apiTx EthTxidB1T2",
			r:           newGetRequest(ts.URL + "/api/v2/tx/0x" + dbtestdata.EthTxidB1T2),
			status:      http.StatusOK,
			contentType: "application/json; charset=utf-8",
			body: []string{
				`{"txid":"0xa9cd088aba2131000da6f38a33c20169baee476218deea6b78720700b895b101","vin":[{"n":0,"addresses":["0x20cD153de35D469BA46127A0C8F18626b59a256A"],"isAddress":true}],"vout":[{"value":"0","n":0,"addresses":["0x4af4114F73d1c1C903aC9E0361b379D1291808A2"],"isAddress":true}],"blockHeight":-1,"confirmations":0,"blockTime":0,"value":"0","fees":"2081000000000000","rbf":true,"coinSpecificData":{"tx":{"nonce":"0xd0","gasPrice":"0x9502f9000","gas":"0x130d5","to":"0x4af4114F73d1c1C903aC9E0361b379D1291808A2","value":"0x0","input":"0xa9059cbb000000000000000000000000555ee11fbddc0e49a9bab358a8941ad95ffdb48f00000000000000000000000000000000000000000000021e19e0c9bab2400000","hash":"0xa9cd088aba2131000da6f38a33c20169baee476218deea6b78720700b895b101","blockNumber":"0x41eee8","from":"0x20cD153de35D469BA46127A0C8F18626b59a256A","transactionIndex":"0x0"},"internalData":{"type":0,"transfers":[{"type":1,"from":"9f4981531fda132e83c44680787dfa7ee31e4f8d","to":"4af4114f73d1c1c903ac9e0361b379d1291808a2","value":1000000},{"type":0,"from":"3e3a3d69dc66ba10737f531ed088954a9ec89d97","to":"9f4981531fda132e83c44680787dfa7ee31e4f8d","value":1000001},{"type":0,"from":"3e3a3d69dc66ba10737f531ed088954a9ec89d97","to":"3e3a3d69dc66ba10737f531ed088954a9ec89d97","value":1000002}],"Error":""},"receipt":{"gasUsed":"0xcb39","status":"0x1","logs":[{"address":"0x4af4114F73d1c1C903aC9E0361b379D1291808A2","topics":["0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef","0x00000000000000000000000020cd153de35d469ba46127a0c8f18626b59a256a","0x000000000000000000000000555ee11fbddc0e49a9bab358a8941ad95ffdb48f"],"data":"0x00000000000000000000000000000000000000000000021e19e0c9bab2400000"}]}},"tokenTransfers":[{"type":"ERC20","from":"0x20cD153de35D469BA46127A0C8F18626b59a256A","to":"0x555Ee11FBDDc0E49A9bAB358A8941AD95fFDB48f","token":"0x4af4114F73d1c1C903aC9E0361b379D1291808A2","name":"Contract 74","symbol":"S74","decimals":12,"value":"10000000000000000000000"}],"ethereumSpecific":{"status":1,"nonce":208,"gasLimit":78037,"gasUsed":52025,"gasPrice":"40000000000","data":"0xa9059cbb000000000000000000000000555ee11fbddc0e49a9bab358a8941ad95ffdb48f00000000000000000000000000000000000000000000021e19e0c9bab2400000","parsedData":{"methodId":"0xa9059cbb","name":"Transfer","function":"transfer(address, uint256)","params":[{"type":"address","values":["0x555Ee11FBDDc0E49A9bAB358A8941AD95fFDB48f"]},{"type":"uint256","values":["10000000000000000000000"]}]}},"addressAliases":{"0x20cD153de35D469BA46127A0C8F18626b59a256A":{"Type":"ENS","Alias":"address20.eth"},"0x4af4114F73d1c1C903aC9E0361b379D1291808A2":{"Type":"Contract","Alias":"Contract 74"}}}`,
			},
		},
		{
			name:        "apiFiatRates get rate by timestamp",
			r:           newGetRequest(ts.URL + "/api/v2/tickers?currency=usd&timestamp=1574340000"),
			status:      http.StatusOK,
			contentType: "application/json; charset=utf-8",
			body: []string{
				`{"ts":1574344800,"rates":{"usd":7814.5}}`,
			},
		},
		{
			name:        "apiFiatRates get token rate by timestamp",
			r:           newGetRequest(ts.URL + "/api/v2/tickers?currency=usd&timestamp=1574340000&token=0xA4DD6Bc15Be95Af55f0447555c8b6aA3088562f3"),
			status:      http.StatusOK,
			contentType: "application/json; charset=utf-8",
			body: []string{
				`{"ts":1574344800,"rates":{"usd":6251.6}}`,
			},
		},
		{
			name:        "apiFiatRates get token rate by timestamp for all currencies",
			r:           newGetRequest(ts.URL + "/api/v2/tickers?timestamp=1574340000&token=0xA4DD6Bc15Be95Af55f0447555c8b6aA3088562f3"),
			status:      http.StatusBadRequest,
			contentType: "application/json; charset=utf-8",
			body: []string{
				`{"error":"Rates for token only for a single currency"}`,
			},
		},
		{
			name:        "apiFiatRates get token rate for unknown token by timestamp",
			r:           newGetRequest(ts.URL + "/api/v2/tickers?currency=usd&timestamp=1574340000&token=0xFFFFFFFFFFe95Af55f0447555c8b6aA3088562f3"),
			status:      http.StatusOK,
			contentType: "application/json; charset=utf-8",
			body: []string{
				`{"ts":1574340000,"rates":{"usd":-1}}`,
			},
		},
	}

	performHttpTests(tests, t, ts)
}

func initEthereumTypeDB(d *db.RocksDB) error {
	// add 0xa9059cbb transfer(address,uint256)	signature
	wb := grocksdb.NewWriteBatch()
	defer wb.Destroy()
	if err := d.StoreFourByteSignature(wb, 2835717307, 145, &bchain.FourByteSignature{
		Name:       "transfer",
		Parameters: []string{"address", "uint256"},
	}); err != nil {
		return err
	}
	return d.WriteBatch(wb)
}

// initTestFiatRatesEthereumType initializes test data for /api/v2/tickers endpoint
func initTestFiatRatesEthereumType(d *db.RocksDB) error {
	if err := insertFiatRate("20180320020000", map[string]float32{
		"usd": 2000.0,
		"eur": 1300.0,
	}, map[string]float32{
		"0xdac17f958d2ee523a2206206994597c13d831ec7": 2000.1,
		"0x2260fac5e5542a773aa44fbcfedf7c193bc2c599": 123.0,
	}, d); err != nil {
		return err
	}
	if err := insertFiatRate("20180320030000", map[string]float32{
		"usd": 2001.0,
		"eur": 1301.0,
	}, map[string]float32{
		"0xdac17f958d2ee523a2206206994597c13d831ec7": 2001.1,
		"0x2260fac5e5542a773aa44fbcfedf7c193bc2c599": 199.0,
	}, d); err != nil {
		return err
	}
	if err := insertFiatRate("20180320040000", map[string]float32{
		"usd": 2002.0,
		"eur": 1302.0,
	}, map[string]float32{
		"0xdac17f958d2ee523a2206206994597c13d831ec7": 2002.1,
		"0x2260fac5e5542a773aa44fbcfedf7c193bc2c599": 99.0,
	}, d); err != nil {
		return err
	}
	if err := insertFiatRate("20180321055521", map[string]float32{
		"usd": 2003.0,
		"eur": 1303.0,
	}, map[string]float32{
		"0xdac17f958d2ee523a2206206994597c13d831ec7": 2003.1,
		"0x2260fac5e5542a773aa44fbcfedf7c193bc2c599": 101.0,
	}, d); err != nil {
		return err
	}
	if err := insertFiatRate("20191121140000", map[string]float32{
		"usd": 7814.5,
		"eur": 7100.0,
	}, map[string]float32{
		"0xdac17f958d2ee523a2206206994597c13d831ec7": 7814.1,
		"0x2260fac5e5542a773aa44fbcfedf7c193bc2c599": 499.0,
		"0xa4dd6bc15be95af55f0447555c8b6aa3088562f3": 0.8,
	}, d); err != nil {
		return err
	}
	return insertFiatRate("20191121143015", map[string]float32{
		"usd": 7914.5,
		"eur": 7134.1,
	}, map[string]float32{
		"0xdac17f958d2ee523a2206206994597c13d831ec7": 7914.1,
		"0x2260fac5e5542a773aa44fbcfedf7c193bc2c599": 599.0,
		"0xa4dd6bc15be95af55f0447555c8b6aa3088562f3": 1.2,
	}, d)
}

func Test_PublicServer_EthereumType(t *testing.T) {
	parser := eth.NewEthereumParser(1, true)
	chain, err := dbtestdata.NewFakeBlockChainEthereumType(parser)
	if err != nil {
		glog.Fatal("fakechain: ", err)
	}

	s, dbpath := setupPublicHTTPServer(parser, chain, t)
	defer closeAndDestroyPublicServer(t, s, dbpath)
	s.ConnectFullPublicInterface()
	// take the handler of the public server and pass it to the test server
	ts := httptest.NewServer(s.https.Handler)
	defer ts.Close()

	httpTestsEthereumType(t, ts)
}
